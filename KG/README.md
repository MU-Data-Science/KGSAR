# Generating Knowledge Graphs from the Notary Records

# Description

Generate knowledge graphs by utilizing Resource Description Framework (RDF) on cleaned, denoised images. 

If you want to transfer files between your Cloudlab node and your local system or vice-versa, please use the following:

    $ scp -r src dest

For example, if I wish to transfer files from my local system to Cloudlab:

    $ scp -r /Desktop/folder Creator@Node.Cluster.cloudlab.us:/mydata/folder

![DataTransfer](/Screenshots/gen-kg-scp.png)

Make 3 directories, one for uncleaned-images, cleaned-images and JSON files:

    $ cd KG
    $ mkdir uncleaned-images
    $ mkdir cleaned-images
    $ mkdir JSON
    $ mkdir JSON/Keras

![MKDIR](/Screenshots/gen-kg-mkdir.png)

Then, add all the uncleaned images to the 'uncleaned-images' folder.

# Cleaning Images

Run [cleanImage.py](/KG/Code/cleanImage.py) to change blur and threshold values to clean the original, digitized notary records in order for the models to be able to predict well.

To run as a standalone code, please uncomment lines 16-24 & 47 and run as following:

```
    $ python3 cleanImage.py -i /input/path -o /output/path
```

If you are running this as a standalone code, it would mean that you only want to clean the images

# Getting the predictions

Run [predictions.py](/KG/Code/predictions.py) to apply the [Keras-OCR model](/KG/Model/recognizer_custom.h5) to get predictions and bounding boxes for each image.

To run as a standalone code, please uncomment lines 19-33 & 71 and run as following:

```
    $ python3 predictions.py -i /images/path -o /output/path -j /output/json/path -m /model/path
```

If you are running this as a standalone code, it would mean that you already have cleaned images.

![Cleaning-Prediction](/Screenshots/gen-kg-clean-pred.png)

# Generating knowledge graphs

Run as [kg.py](/KG/Code/kg.py) to use the predictions and bounding boxes generated by the model to populate knowledge graphs.

If the lines in the above two code files were not uncommented, kg.py will sequentially call the code snippets. Run the code as following:

```
    $ python3 kg.py -i /full/path/to/original/images -o /full/path/to/cleaned/images -j /full/path/to/store/JSONfiles -r /path/to/JSONfiles -m /model/path -e /list/of/notaries/xlsx
```

If you are running this as a standalone code, it would mean that you already have the predictions from the cleaned images.

![KG-Completed](/Screenshots/gen-kg-completed.png)

Note: If you get an error message like this: "ImportError: libGL.so.1: cannot open shared object file: No such file or directory" while running any of the above code, please run this (this is highly dependent on the Cloudlab node picked, and the order in which all the packages were installed):

    $ sudo apt-get install python3-opencv

This pipeline works with Keras-OCR and YOLO-OCR and can take as input, any number of images. Conda environment installation requirements are mentioned in kg.py

## Contributing Authors:

**Shivika Prasanna** 

**Nouf Alrasheed**
